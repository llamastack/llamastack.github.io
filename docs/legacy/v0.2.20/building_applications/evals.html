


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evaluations &mdash; llama-stack 0.2.20 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/my_theme.css?v=f1163765" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=20e0ead2"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=09bf800d"></script>
      <script src="../_static/js/detect_theme.js?v=76226c80"></script>
      <script src="../_static/js/keyboard_shortcuts.js?v=62563c3b"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
      <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Telemetry" href="telemetry.html" />
    <link rel="prev" title="Tools" href="tools.html" />
 

<script src="../_static/version-loader.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            llama-stack
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Llama Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../providers/index.html">API Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributions/index.html">Distributions Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_apis/index.html">Advanced APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">AI Application Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="rag.html">Retrieval Augmented Generation (RAG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent_execution_loop.html">Agent Execution Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="responses_vs_agents.html">Agents vs OpenAI Responses API</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Evaluations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#application-evaluation">Application Evaluation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-a-search-agent">Building a Search Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-agent-execution-steps">Query Agent Execution Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#evaluate-agent-responses">Evaluate Agent Responses</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="telemetry.html">Telemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="safety.html">Safety Guardrails</a></li>
<li class="toctree-l2"><a class="reference internal" href="playground/index.html">Llama Stack Playground</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deploying/index.html">Deployment Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing to Llama Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html#llama-stack-benchmark-suite-on-kubernetes">Llama Stack Benchmark Suite on Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/index.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">llama-stack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">AI Application Examples</a></li>
      <li class="breadcrumb-item active">Evaluations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/building_applications/evals.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="evaluations">
<h1>Evaluations<a class="headerlink" href="#evaluations" title="Link to this heading"></a></h1>
<p>The Llama Stack provides a set of APIs in Llama Stack for supporting running evaluations of LLM applications.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/datasetio</span></code> + <code class="docutils literal notranslate"><span class="pre">/datasets</span></code> API</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/scoring</span></code> + <code class="docutils literal notranslate"><span class="pre">/scoring_functions</span></code> API</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/eval</span></code> + <code class="docutils literal notranslate"><span class="pre">/benchmarks</span></code> API</p></li>
</ul>
<p>This guides walks you through the process of evaluating an LLM application built using Llama Stack. Checkout the <a class="reference internal" href="../references/evals_reference/index.html"><span class="std std-doc">Evaluation Reference</span></a> guide goes over the sets of APIs and developer experience flow of using Llama Stack to run evaluations for benchmark and application use cases. Checkout our Colab notebook on working examples with evaluations <a class="reference external" href="https://colab.research.google.com/drive/10CHyykee9j2OigaIcRv47BKG9mrNm0tJ?usp=sharing">here</a>.</p>
<section id="application-evaluation">
<h2>Application Evaluation<a class="headerlink" href="#application-evaluation" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://colab.research.google.com/github/meta-llama/llama-stack/blob/main/docs/getting_started.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>Llama Stack offers a library of scoring functions and the <code class="docutils literal notranslate"><span class="pre">/scoring</span></code> API, allowing you to run evaluations on your pre-annotated AI application datasets.</p>
<p>In this example, we will show you how to:</p>
<ol class="arabic simple">
<li><p>Build an Agent with Llama Stack</p></li>
<li><p>Query the agent’s sessions, turns, and steps</p></li>
<li><p>Evaluate the results.</p></li>
</ol>
<section id="building-a-search-agent">
<h3>Building a Search Agent<a class="headerlink" href="#building-a-search-agent" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">llama_stack_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlamaStackClient</span><span class="p">,</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">AgentEventLogger</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">LlamaStackClient</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">PORT</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">client</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;meta-llama/Llama-3.3-70B-Instruct&quot;</span><span class="p">,</span>
    <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant. Use search tool to answer the questions. &quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;builtin::websearch&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">user_prompts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Which teams played in the NBA Western Conference Finals of 2024. Search the web for the answer.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;In which episode and season of South Park does Bill Cosby (BSM-471) first appear? Give me the number and title. Search the web for the answer.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What is the British-American kickboxer Andrew Tate&#39;s kickboxing name? Search the web for the answer.&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">session_id</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span><span class="s2">&quot;test-session&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">user_prompts</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">create_turn</span><span class="p">(</span>
        <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">AgentEventLogger</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="query-agent-execution-steps">
<h3>Query Agent Execution Steps<a class="headerlink" href="#query-agent-execution-steps" title="Link to this heading"></a></h3>
<p>Now, let’s look deeper into the agent’s execution steps and see if how well our agent performs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># query the agents session</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.pretty</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>

<span class="n">session_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
    <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
    <span class="n">agent_id</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">session_response</span><span class="p">)</span>
</pre></div>
</div>
<p>As a sanity check, we will first check if all user prompts is followed by a tool call to <code class="docutils literal notranslate"><span class="pre">brave_search</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_tool_call</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">turn</span> <span class="ow">in</span> <span class="n">session_response</span><span class="o">.</span><span class="n">turns</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">turn</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">step</span><span class="o">.</span><span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;tool_execution&quot;</span>
            <span class="ow">and</span> <span class="n">step</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tool_name</span> <span class="o">==</span> <span class="s2">&quot;brave_search&quot;</span>
        <span class="p">):</span>
            <span class="n">num_tool_call</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_tool_call</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">session_response</span><span class="o">.</span><span class="n">turns</span><span class="p">)</span><span class="si">}</span><span class="s2"> user prompts are followed by a tool call to `brave_search`&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="evaluate-agent-responses">
<h3>Evaluate Agent Responses<a class="headerlink" href="#evaluate-agent-responses" title="Link to this heading"></a></h3>
<p>Now, we want to evaluate the agent’s responses to the user prompts.</p>
<ol class="arabic simple">
<li><p>First, we will process the agent’s execution history into a list of rows that can be used for evaluation.</p></li>
<li><p>Next, we will label the rows with the expected answer.</p></li>
<li><p>Finally, we will use the <code class="docutils literal notranslate"><span class="pre">/scoring</span></code> API to score the agent’s responses.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">eval_rows</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">expected_answers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Dallas Mavericks and the Minnesota Timberwolves&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Season 4, Episode 12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;King Cobra&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">turn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_response</span><span class="o">.</span><span class="n">turns</span><span class="p">):</span>
    <span class="n">eval_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;input_query&quot;</span><span class="p">:</span> <span class="n">turn</span><span class="o">.</span><span class="n">input_messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s2">&quot;generated_answer&quot;</span><span class="p">:</span> <span class="n">turn</span><span class="o">.</span><span class="n">output_message</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s2">&quot;expected_answer&quot;</span><span class="p">:</span> <span class="n">expected_answers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">eval_rows</span><span class="p">)</span>

<span class="n">scoring_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;basic::subset_of&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">scoring_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">score</span><span class="p">(</span>
    <span class="n">input_rows</span><span class="o">=</span><span class="n">eval_rows</span><span class="p">,</span> <span class="n">scoring_functions</span><span class="o">=</span><span class="n">scoring_params</span>
<span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">scoring_response</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tools.html" class="btn btn-neutral float-left" title="Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="telemetry.html" class="btn btn-neutral float-right" title="Telemetry" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Meta.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Read the Docs</span>
    v: v0.2.20
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      <dd>
        <a href="/v0.2.20/">latest</a>
      </dd>
      <dd class="rtd-current-item">
        <a href="/v0.2.20/">v0.2.20</a>
      </dd>
      <dd>
        <a href="/v0.2.19/">v0.2.19</a>
      </dd>
      <dd>
        <a href="/v0.2.18/">v0.2.18</a>
      </dd>
      <dd>
        <a href="/v0.2.17/">v0.2.17</a>
      </dd>
      <dd>
        <a href="/v0.2.16/">v0.2.16</a>
      </dd>
      <dd>
        <a href="/v0.2.15/">v0.2.15</a>
      </dd>
      <dd>
        <a href="/v0.2.14/">v0.2.14</a>
      </dd>
      <dd>
        <a href="/v0.2.13/">v0.2.13</a>
      </dd>
      <dd>
        <a href="/v0.2.12/">v0.2.12</a>
      </dd>
      <dd>
        <a href="/v0.2.11/">v0.2.11</a>
      </dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>