


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuring a ‚ÄúStack‚Äù &mdash; llama-stack 0.2.17 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/my_theme.css?v=f1163765" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=46390ad3"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=09bf800d"></script>
      <script src="../_static/js/detect_theme.js?v=76226c80"></script>
      <script src="../_static/js/keyboard_shortcuts.js"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
      <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced APIs" href="../advanced_apis/index.html" />
    <link rel="prev" title="Using Llama Stack as a Library" href="importing_as_library.html" />
 

<script src="../_static/version-loader.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            llama-stack
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Llama Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../providers/index.html">API Providers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Distributions Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="list_of_distributions.html">Available Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_distro.html">Build your own Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="customizing_run_yaml.html">Customizing run.yaml Files</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="starting_llama_stack_server.html">Starting a Llama Stack Server</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="starting_llama_stack_server.html#as-a-library">As a Library:</a></li>
<li class="toctree-l3"><a class="reference internal" href="starting_llama_stack_server.html#container">Container:</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="starting_llama_stack_server.html#kubernetes">Kubernetes:</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="importing_as_library.html">Using Llama Stack as a Library</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Configuring a ‚ÄúStack‚Äù</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="importing_as_library.html">Using Llama Stack as a Library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Configuring a ‚ÄúStack‚Äù</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#providers">Providers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#environment-variable-substitution">Environment Variable Substitution</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#resources">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-configuration">Server Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentication-configuration">Authentication Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-control">Access control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quota-configuration">Quota Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extending-to-handle-safety">Extending to handle Safety</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_apis/index.html">Advanced APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building_applications/index.html">AI Application Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploying/index.html">Deployment Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing to Llama-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/index.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">llama-stack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Distributions Overview</a></li>
          <li class="breadcrumb-item"><a href="starting_llama_stack_server.html">Starting a Llama Stack Server</a></li>
      <li class="breadcrumb-item active">Configuring a ‚ÄúStack‚Äù</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/distributions/configuration.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="configuring-a-stack">
<h1>Configuring a ‚ÄúStack‚Äù<a class="headerlink" href="#configuring-a-stack" title="Link to this heading">ÔÉÅ</a></h1>
<p>The Llama Stack runtime configuration is specified as a YAML file. Here is a simplified version of an example configuration file for the Ollama distribution:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default <code class="docutils literal notranslate"><span class="pre">run.yaml</span></code> files generated by templates are starting points for your configuration. For guidance on customizing these files for your specific needs, see <a class="reference internal" href="customizing_run_yaml.html"><span class="std std-doc">Customizing Your run.yaml Configuration</span></a>.</p>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">üëã Click here for a Sample Configuration File</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">apis</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agents</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inference</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vector_io</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">safety</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telemetry</span>
<span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inference</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ollama</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote::ollama</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.OLLAMA_URL:=http://localhost:11434}</span>
<span class="w">  </span><span class="nt">vector_io</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">faiss</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inline::faiss</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kvstore</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">        </span><span class="nt">db_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.SQLITE_STORE_DIR:=~/.llama/distributions/ollama}/faiss_store.db</span>
<span class="w">  </span><span class="nt">safety</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">llama-guard</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inline::llama-guard</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">agents</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-reference</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inline::meta-reference</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">persistence_store</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">        </span><span class="nt">db_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.SQLITE_STORE_DIR:=~/.llama/distributions/ollama}/agents_store.db</span>
<span class="w">  </span><span class="nt">telemetry</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-reference</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inline::meta-reference</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="nt">metadata_store</span><span class="p">:</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite</span>
<span class="w">  </span><span class="nt">db_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.SQLITE_STORE_DIR:=~/.llama/distributions/ollama}/registry.db</span>
<span class="nt">models</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.INFERENCE_MODEL}</span>
<span class="w">  </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ollama</span>
<span class="w">  </span><span class="nt">provider_model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="nt">shields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8321</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;oauth2_token&quot;</span>
<span class="w">      </span><span class="nt">jwks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://my-token-issuing-svc.com/jwks&quot;</span>
</pre></div>
</div>
</div>
</details><p>Let‚Äôs break this down into the different sections. The first section specifies the set of APIs that the stack server will serve:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apis</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agents</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inference</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vector_io</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">safety</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telemetry</span>
</pre></div>
</div>
<section id="providers">
<h2>Providers<a class="headerlink" href="#providers" title="Link to this heading">ÔÉÅ</a></h2>
<p>Next up is the most critical part: the set of providers that the stack will use to serve the above APIs. Consider the <code class="docutils literal notranslate"><span class="pre">inference</span></code> API:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inference</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># provider_id is a string you can choose freely</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ollama</span>
<span class="w">    </span><span class="c1"># provider_type is a string that specifies the type of provider.</span>
<span class="w">    </span><span class="c1"># in this case, the provider for inference is ollama and it runs remotely (outside of the distribution)</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote::ollama</span>
<span class="w">    </span><span class="c1"># config is a dictionary that contains the configuration for the provider.</span>
<span class="w">    </span><span class="c1"># in this case, the configuration is the url of the ollama server</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.OLLAMA_URL:=http://localhost:11434}</span>
</pre></div>
</div>
<p>A few things to note:</p>
<ul class="simple">
<li><p>A <em>provider instance</em> is identified with an (id, type, config) triplet.</p></li>
<li><p>The id is a string you can choose freely.</p></li>
<li><p>You can instantiate any number of provider instances of the same type.</p></li>
<li><p>The configuration dictionary is provider-specific.</p></li>
<li><p>Notice that configuration can reference environment variables (with default values), which are expanded at runtime. When you run a stack server (via docker or via <code class="docutils literal notranslate"><span class="pre">llama</span> <span class="pre">stack</span> <span class="pre">run</span></code>), you can specify <code class="docutils literal notranslate"><span class="pre">--env</span> <span class="pre">OLLAMA_URL=http://my-server:11434</span></code> to override the default value.</p></li>
</ul>
<section id="environment-variable-substitution">
<h3>Environment Variable Substitution<a class="headerlink" href="#environment-variable-substitution" title="Link to this heading">ÔÉÅ</a></h3>
<p>Llama Stack supports environment variable substitution in configuration values using the
<code class="docutils literal notranslate"><span class="pre">${env.VARIABLE_NAME}</span></code> syntax. This allows you to externalize configuration values and provide
different settings for different environments. The syntax is inspired by <a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">bash parameter expansion</a>
and follows similar patterns.</p>
<section id="basic-syntax">
<h4>Basic Syntax<a class="headerlink" href="#basic-syntax" title="Link to this heading">ÔÉÅ</a></h4>
<p>The basic syntax for environment variable substitution is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.API_KEY}</span>
<span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.SERVICE_URL}</span>
</pre></div>
</div>
<p>If the environment variable is not set, the server will raise an error during startup.</p>
</section>
<section id="default-values">
<h4>Default Values<a class="headerlink" href="#default-values" title="Link to this heading">ÔÉÅ</a></h4>
<p>You can provide default values using the <code class="docutils literal notranslate"><span class="pre">:=</span></code> operator:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.OLLAMA_URL:=http://localhost:11434}</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.PORT:=8321}</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.TIMEOUT:=60}</span>
</pre></div>
</div>
<p>If the environment variable is not set, the default value <code class="docutils literal notranslate"><span class="pre">http://localhost:11434</span></code> will be used.
Empty defaults are allowed so <code class="docutils literal notranslate"><span class="pre">url:</span> <span class="pre">${env.OLLAMA_URL:=}</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> if the environment variable is not set.</p>
</section>
<section id="conditional-values">
<h4>Conditional Values<a class="headerlink" href="#conditional-values" title="Link to this heading">ÔÉÅ</a></h4>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">:+</span></code> operator to provide a value only when the environment variable is set:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Only include this field if ENVIRONMENT is set</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.ENVIRONMENT:+production}</span>
</pre></div>
</div>
<p>If the environment variable is set, the value after <code class="docutils literal notranslate"><span class="pre">:+</span></code> will be used. If it‚Äôs not set, the field
will be omitted with a <code class="docutils literal notranslate"><span class="pre">None</span></code> value.</p>
<p>Do not use conditional values (<code class="docutils literal notranslate"><span class="pre">${env.OLLAMA_URL:+}</span></code>) for empty defaults (<code class="docutils literal notranslate"><span class="pre">${env.OLLAMA_URL:=}</span></code>).
This will be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> if the environment variable is not set.
Conditional must only be used when the environment variable is set.</p>
</section>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Link to this heading">ÔÉÅ</a></h4>
<p>Here are some common patterns:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Required environment variable (will error if not set)</span>
<span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.OPENAI_API_KEY}</span>

<span class="c1"># Optional with default</span>
<span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.API_BASE_URL:=https://api.openai.com/v1}</span>

<span class="c1"># Conditional field</span>
<span class="nt">debug_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.DEBUG:+true}</span>

<span class="c1"># Optional field that becomes None if not set</span>
<span class="nt">optional_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.OPTIONAL_TOKEN:+}</span>
</pre></div>
</div>
</section>
<section id="runtime-override">
<h4>Runtime Override<a class="headerlink" href="#runtime-override" title="Link to this heading">ÔÉÅ</a></h4>
<p>You can override environment variables at runtime when starting the server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Override specific environment variables</span>
llama<span class="w"> </span>stack<span class="w"> </span>run<span class="w"> </span>--config<span class="w"> </span>run.yaml<span class="w"> </span>--env<span class="w"> </span><span class="nv">API_KEY</span><span class="o">=</span>sk-123<span class="w"> </span>--env<span class="w"> </span><span class="nv">BASE_URL</span><span class="o">=</span>https://custom-api.com

<span class="c1"># Or set them in your shell</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">API_KEY</span><span class="o">=</span>sk-123
<span class="nb">export</span><span class="w"> </span><span class="nv">BASE_URL</span><span class="o">=</span>https://custom-api.com
llama<span class="w"> </span>stack<span class="w"> </span>run<span class="w"> </span>--config<span class="w"> </span>run.yaml
</pre></div>
</div>
</section>
<section id="type-safety">
<h4>Type Safety<a class="headerlink" href="#type-safety" title="Link to this heading">ÔÉÅ</a></h4>
<p>The environment variable substitution system is type-safe:</p>
<ul class="simple">
<li><p>String values remain strings</p></li>
<li><p>Empty defaults (<code class="docutils literal notranslate"><span class="pre">${env.VAR:+}</span></code>) are converted to <code class="docutils literal notranslate"><span class="pre">None</span></code> for fields that accept <code class="docutils literal notranslate"><span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span></code></p></li>
<li><p>Numeric defaults are properly typed (e.g., <code class="docutils literal notranslate"><span class="pre">${env.PORT:=8321}</span></code> becomes an integer)</p></li>
<li><p>Boolean defaults work correctly (e.g., <code class="docutils literal notranslate"><span class="pre">${env.DEBUG:=false}</span></code> becomes a boolean)</p></li>
</ul>
</section>
</section>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Link to this heading">ÔÉÅ</a></h2>
<p>Let‚Äôs look at the <code class="docutils literal notranslate"><span class="pre">models</span></code> section:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.INFERENCE_MODEL}</span>
<span class="w">  </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ollama</span>
<span class="w">  </span><span class="nt">provider_model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">llm</span>
</pre></div>
</div>
<p>A Model is an instance of a ‚ÄúResource‚Äù (see <a class="reference internal" href="../concepts/index.html"><span class="doc std std-doc">Concepts</span></a>) and is associated with a specific inference provider (in this case, the provider with identifier <code class="docutils literal notranslate"><span class="pre">ollama</span></code>). This is an instance of a ‚Äúpre-registered‚Äù model. While we always encourage the clients to register models before using them, some Stack servers may come up a list of ‚Äúalready known and available‚Äù models.</p>
<p>What‚Äôs with the <code class="docutils literal notranslate"><span class="pre">provider_model_id</span></code> field? This is an identifier for the model inside the provider‚Äôs model catalog. Contrast it with <code class="docutils literal notranslate"><span class="pre">model_id</span></code> which is the identifier for the same model for Llama Stack‚Äôs purposes. For example, you may want to name ‚Äúllama3.2:vision-11b‚Äù as ‚Äúimage_captioning_model‚Äù when you use it in your Stack interactions. When omitted, the server will set <code class="docutils literal notranslate"><span class="pre">provider_model_id</span></code> to be the same as <code class="docutils literal notranslate"><span class="pre">model_id</span></code>.</p>
<p>If you need to conditionally register a model in the configuration, such as only when specific environment variable(s) are set, this can be accomplished by utilizing a special <code class="docutils literal notranslate"><span class="pre">__disabled__</span></code> string as the default value of an environment variable substitution, as shown below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.INFERENCE_MODEL:__disabled__}</span>
<span class="w">  </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ollama</span>
<span class="w">  </span><span class="nt">provider_model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.INFERENCE_MODEL:__disabled__}</span>
</pre></div>
</div>
<p>The snippet above will only register this model if the environment variable <code class="docutils literal notranslate"><span class="pre">INFERENCE_MODEL</span></code> is set and non-empty. If the environment variable is not set, the model will not get registered at all.</p>
</section>
<section id="server-configuration">
<h2>Server Configuration<a class="headerlink" href="#server-configuration" title="Link to this heading">ÔÉÅ</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">server</span></code> section configures the HTTP server that serves the Llama Stack APIs:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8321</span><span class="w">  </span><span class="c1"># Port to listen on (default: 8321)</span>
<span class="w">  </span><span class="nt">tls_certfile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/cert.pem&quot;</span><span class="w">  </span><span class="c1"># Optional: Path to TLS certificate for HTTPS</span>
<span class="w">  </span><span class="nt">tls_keyfile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/key.pem&quot;</span><span class="w">    </span><span class="c1"># Optional: Path to TLS key for HTTPS</span>
</pre></div>
</div>
<section id="authentication-configuration">
<h3>Authentication Configuration<a class="headerlink" href="#authentication-configuration" title="Link to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><p><strong>Breaking Change (v0.2.14)</strong>: The authentication configuration structure has changed. The previous format with <code class="docutils literal notranslate"><span class="pre">provider_type</span></code> and <code class="docutils literal notranslate"><span class="pre">config</span></code> fields has been replaced with a unified <code class="docutils literal notranslate"><span class="pre">provider_config</span></code> field that includes the <code class="docutils literal notranslate"><span class="pre">type</span></code> field. Update your configuration files accordingly.</p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">auth</span></code> section configures authentication for the server. When configured, all API requests must include a valid Bearer token in the Authorization header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Authorization</span><span class="p">:</span> <span class="n">Bearer</span> <span class="o">&lt;</span><span class="n">token</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The server supports multiple authentication providers:</p>
<section id="oauth-2-0-openid-connect-provider-with-kubernetes">
<h4>OAuth 2.0/OpenID Connect Provider with Kubernetes<a class="headerlink" href="#oauth-2-0-openid-connect-provider-with-kubernetes" title="Link to this heading">ÔÉÅ</a></h4>
<p>The server can be configured to use service account tokens for authorization, validating these against the Kubernetes API server, e.g.:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;oauth2_token&quot;</span>
<span class="w">      </span><span class="nt">jwks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://kubernetes.default.svc:8443/openid/v1/jwks&quot;</span>
<span class="w">        </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${env.TOKEN:+}&quot;</span>
<span class="w">        </span><span class="nt">key_recheck_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span>
<span class="w">      </span><span class="nt">tls_cafile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/ca.crt&quot;</span>
<span class="w">      </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://kubernetes.default.svc&quot;</span>
<span class="w">      </span><span class="nt">audience</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://kubernetes.default.svc&quot;</span>
</pre></div>
</div>
<p>To find your cluster‚Äôs jwks uri (from which the public key(s) to verify the token signature are obtained), run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="o">--</span><span class="n">raw</span> <span class="o">/.</span><span class="n">well</span><span class="o">-</span><span class="n">known</span><span class="o">/</span><span class="n">openid</span><span class="o">-</span><span class="n">configuration</span><span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="o">.</span><span class="n">jwks_uri</span>
</pre></div>
</div>
<p>For the tls_cafile, you can use the CA certificate of the OIDC provider:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--minify<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.clusters[0].cluster.certificate-authority}&#39;</span>
</pre></div>
</div>
<p>For the issuer, you can use the OIDC provider‚Äôs URL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>--raw<span class="w"> </span>/.well-known/openid-configuration<span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.issuer
</pre></div>
</div>
<p>The audience can be obtained from a token, e.g. run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>create<span class="w"> </span>token<span class="w"> </span>default<span class="w"> </span>--duration<span class="o">=</span>1h<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d.<span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.aud
</pre></div>
</div>
<p>The jwks token is used to authorize access to the jwks endpoint. You can obtain a token by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>llama-stack
kubectl<span class="w"> </span>create<span class="w"> </span>serviceaccount<span class="w"> </span>llama-stack-auth<span class="w"> </span>-n<span class="w"> </span>llama-stack
kubectl<span class="w"> </span>create<span class="w"> </span>token<span class="w"> </span>llama-stack-auth<span class="w"> </span>-n<span class="w"> </span>llama-stack<span class="w"> </span>&gt;<span class="w"> </span>llama-stack-auth-token
<span class="nb">export</span><span class="w"> </span><span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>llama-stack-auth-token<span class="k">)</span>
</pre></div>
</div>
<p>Alternatively, you can configure the jwks endpoint to allow anonymous access. To do this, make sure
the <code class="docutils literal notranslate"><span class="pre">kube-apiserver</span></code> runs with <code class="docutils literal notranslate"><span class="pre">--anonymous-auth=true</span></code> to allow unauthenticated requests
and that the correct RoleBinding is created to allow the service account to access the necessary
resources. If that is not the case, you can create a RoleBinding for the service account to access
the necessary resources:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># allow-anonymous-openid.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-anonymous-openid</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nonResourceURLs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/openid/v1/jwks&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-anonymous-openid</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-anonymous-openid</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">User</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system:anonymous</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</pre></div>
</div>
<p>And then apply the configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>allow-anonymous-openid.yaml
</pre></div>
</div>
<p>The provider extracts user information from the JWT token:</p>
<ul class="simple">
<li><p>Username from the <code class="docutils literal notranslate"><span class="pre">sub</span></code> claim becomes a role</p></li>
<li><p>Kubernetes groups become teams</p></li>
</ul>
<p>You can easily validate a request by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-s<span class="w"> </span>-L<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="k">$(</span>cat<span class="w"> </span>llama-stack-auth-token<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>http://127.0.0.1:8321/v1/providers
</pre></div>
</div>
</section>
<section id="github-token-provider">
<h4>GitHub Token Provider<a class="headerlink" href="#github-token-provider" title="Link to this heading">ÔÉÅ</a></h4>
<p>Validates GitHub personal access tokens or OAuth tokens directly:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;github_token&quot;</span>
<span class="w">      </span><span class="nt">github_api_base_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://api.github.com&quot;</span><span class="w">  </span><span class="c1"># Or GitHub Enterprise URL</span>
</pre></div>
</div>
<p>The provider fetches user information from GitHub and maps it to access attributes based on the <code class="docutils literal notranslate"><span class="pre">claims_mapping</span></code> configuration.</p>
</section>
<section id="custom-provider">
<h4>Custom Provider<a class="headerlink" href="#custom-provider" title="Link to this heading">ÔÉÅ</a></h4>
<p>Validates tokens against a custom authentication endpoint:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;custom&quot;</span>
<span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://auth.example.com/validate&quot;</span><span class="w">  </span><span class="c1"># URL of the auth endpoint</span>
</pre></div>
</div>
<p>The custom endpoint receives a POST request with:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;api_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;token&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/api/v1/endpoint&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;content-type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;user-agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;curl/7.64.1&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And must respond with:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;access_attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;teams&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ml-team&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;nlp-team&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;projects&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;llama-3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;project-x&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;namespaces&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;research&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Authentication successful&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If no access attributes are returned, the token is used as a namespace.</p>
</section>
</section>
<section id="access-control">
<h3>Access control<a class="headerlink" href="#access-control" title="Link to this heading">ÔÉÅ</a></h3>
<p>When authentication is enabled, access to resources is controlled
through the <code class="docutils literal notranslate"><span class="pre">access_policy</span></code> attribute of the auth config section under
server. The value for this is a list of access rules.</p>
<p>Each access rule defines a list of actions either to permit or to
forbid. It may specify a principal or a resource that must match for
the rule to take effect.</p>
<p>Valid actions are create, read, update, and delete. The resource to
match should be specified in the form of a type qualified identifier,
e.g.  model::my-model or vector_db::some-db, or a wildcard for all
resources of a type, e.g. model::*. If the principal or resource are
not specified, they will match all requests.</p>
<p>The valid resource types are model, shield, vector_db, dataset,
scoring_function, benchmark, tool, tool_group and session.</p>
<p>A rule may also specify a condition, either a ‚Äòwhen‚Äô or an ‚Äòunless‚Äô,
with additional constraints as to where the rule applies. The
constraints supported at present are:</p>
<ul class="simple">
<li><p>‚Äòuser with <attr-value> in <attr-name>‚Äô</p></li>
<li><p>‚Äòuser with <attr-value> not in <attr-name>‚Äô</p></li>
<li><p>‚Äòuser is owner‚Äô</p></li>
<li><p>‚Äòuser is not owner‚Äô</p></li>
<li><p>‚Äòuser in owners <attr-name>‚Äô</p></li>
<li><p>‚Äòuser not in owners <attr-name>‚Äô</p></li>
</ul>
<p>The attributes defined for a user will depend on how the auth
configuration is defined.</p>
<p>When checking whether a particular action is allowed by the current
user for a resource, all the defined rules are tested in order to find
a match. If a match is found, the request is permitted or forbidden
depending on the type of rule. If no match is found, the request is
denied.</p>
<p>If no explicit rules are specified, a default policy is defined with
which all users can access all resources defined in config but
resources created dynamically can only be accessed by the user that
created them.</p>
<p>Examples:</p>
<p>The following restricts access to particular github users:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;github_token&quot;</span>
<span class="w">      </span><span class="nt">github_api_base_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://api.github.com&quot;</span>
<span class="w">  </span><span class="nt">access_policy</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">permit</span><span class="p">:</span>
<span class="w">      </span><span class="nt">principal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-1</span>
<span class="w">      </span><span class="nt">actions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">create</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">read</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">delete</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-1 has full access to all resources</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">permit</span><span class="p">:</span>
<span class="w">      </span><span class="nt">principal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-2</span>
<span class="w">      </span><span class="nt">actions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">read</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">resource</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">model::model-1</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-2 has read access to model-1 only</span>
</pre></div>
</div>
<p>Similarly, the following restricts access to particular kubernetes
service accounts:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;oauth2_token&quot;</span>
<span class="w">      </span><span class="nt">audience</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://kubernetes.default.svc.cluster.local</span>
<span class="w">      </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://kubernetes.default.svc.cluster.local</span>
<span class="w">      </span><span class="nt">tls_cafile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/gsim/.minikube/ca.crt</span>
<span class="w">      </span><span class="nt">jwks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://kubernetes.default.svc.cluster.local:8443/openid/v1/jwks</span>
<span class="w">        </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.TOKEN}</span>
<span class="w">    </span><span class="nt">access_policy</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">permit</span><span class="p">:</span>
<span class="w">        </span><span class="nt">principal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system:serviceaccount:my-namespace:my-serviceaccount</span>
<span class="w">        </span><span class="nt">actions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">create</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">read</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">delete</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">specific serviceaccount has full access to all resources</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">permit</span><span class="p">:</span>
<span class="w">        </span><span class="nt">principal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system:serviceaccount:default:default</span>
<span class="w">        </span><span class="nt">actions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">read</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">resource</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">model::model-1</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default account has read access to model-1 only</span>
</pre></div>
</div>
<p>The following policy, which assumes that users are defined with roles
and teams by whichever authentication system is in use, allows any
user with a valid token to use models, create resources other than
models, read and delete resources they created and read resources
created by users sharing a team with them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">access_policy</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">permit</span><span class="p">:</span>
        <span class="n">actions</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">]</span>
        <span class="n">resource</span><span class="p">:</span> <span class="n">model</span><span class="p">::</span><span class="o">*</span>
      <span class="n">description</span><span class="p">:</span> <span class="nb">all</span> <span class="n">users</span> <span class="n">have</span> <span class="n">read</span> <span class="n">access</span> <span class="n">to</span> <span class="n">models</span>
    <span class="o">-</span> <span class="n">forbid</span><span class="p">:</span>
        <span class="n">actions</span><span class="p">:</span> <span class="p">[</span><span class="n">create</span><span class="p">,</span> <span class="n">delete</span><span class="p">]</span>
        <span class="n">resource</span><span class="p">:</span> <span class="n">model</span><span class="p">::</span><span class="o">*</span>
      <span class="n">unless</span><span class="p">:</span> <span class="n">user</span> <span class="k">with</span> <span class="n">admin</span> <span class="ow">in</span> <span class="n">roles</span>
      <span class="n">description</span><span class="p">:</span> <span class="n">only</span> <span class="n">user</span> <span class="k">with</span> <span class="n">admin</span> <span class="n">role</span> <span class="n">can</span> <span class="n">create</span> <span class="ow">or</span> <span class="n">delete</span> <span class="n">models</span>
    <span class="o">-</span> <span class="n">permit</span><span class="p">:</span>
        <span class="n">actions</span><span class="p">:</span> <span class="p">[</span><span class="n">create</span><span class="p">,</span> <span class="n">read</span><span class="p">,</span> <span class="n">delete</span><span class="p">]</span>
      <span class="n">when</span><span class="p">:</span> <span class="n">user</span> <span class="ow">is</span> <span class="n">owner</span>
      <span class="n">description</span><span class="p">:</span> <span class="n">users</span> <span class="n">can</span> <span class="n">create</span> <span class="n">resources</span> <span class="n">other</span> <span class="n">than</span> <span class="n">models</span> <span class="ow">and</span> <span class="n">read</span> <span class="ow">and</span> <span class="n">delete</span> <span class="n">those</span> <span class="n">they</span> <span class="n">own</span>
    <span class="o">-</span> <span class="n">permit</span><span class="p">:</span>
        <span class="n">actions</span><span class="p">:</span> <span class="p">[</span><span class="n">read</span><span class="p">]</span>
      <span class="n">when</span><span class="p">:</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">owner</span> <span class="n">teams</span>
      <span class="n">description</span><span class="p">:</span> <span class="nb">any</span> <span class="n">user</span> <span class="n">has</span> <span class="n">read</span> <span class="n">access</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">resource</span> <span class="n">created</span> <span class="n">by</span> <span class="n">a</span> <span class="n">user</span> <span class="k">with</span> <span class="n">the</span> <span class="n">same</span> <span class="n">team</span>
</pre></div>
</div>
<section id="api-endpoint-authorization-with-scopes">
<h4>API Endpoint Authorization with Scopes<a class="headerlink" href="#api-endpoint-authorization-with-scopes" title="Link to this heading">ÔÉÅ</a></h4>
<p>In addition to resource-based access control, Llama Stack supports endpoint-level authorization using OAuth 2.0 style scopes. When authentication is enabled, specific API endpoints require users to have particular scopes in their authentication token.</p>
<p><strong>Scope-Gated APIs:</strong>
The following APIs are currently gated by scopes:</p>
<ul class="simple">
<li><p><strong>Telemetry API</strong> (scope: <code class="docutils literal notranslate"><span class="pre">telemetry.read</span></code>):</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/telemetry/traces</span></code> - Query traces</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/telemetry/traces/{trace_id}</span></code> - Get trace by ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/telemetry/traces/{trace_id}/spans/{span_id}</span></code> - Get span by ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/telemetry/spans/{span_id}/tree</span></code> - Get span tree</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/telemetry/spans</span></code> - Query spans</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/telemetry/metrics/{metric_name}</span></code> - Query metrics</p></li>
</ul>
</li>
</ul>
<p><strong>Authentication Configuration:</strong></p>
<p>For <strong>JWT/OAuth2 providers</strong>, scopes should be included in the JWT‚Äôs claims:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;telemetry.read&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;llama-stack&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For <strong>custom authentication providers</strong>, the endpoint must return user attributes including the <code class="docutils literal notranslate"><span class="pre">scopes</span></code> array:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;scopes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;telemetry.read&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Behavior:</strong></p>
<ul class="simple">
<li><p>Users without the required scope receive a 403 Forbidden response</p></li>
<li><p>When authentication is disabled, scope checks are bypassed</p></li>
<li><p>Endpoints without <code class="docutils literal notranslate"><span class="pre">required_scope</span></code> work normally for all authenticated users</p></li>
</ul>
</section>
</section>
<section id="quota-configuration">
<h3>Quota Configuration<a class="headerlink" href="#quota-configuration" title="Link to this heading">ÔÉÅ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">quota</span></code> section allows you to enable server-side request throttling for both
authenticated and anonymous clients. This is useful for preventing abuse, enforcing
fairness across tenants, and controlling infrastructure costs without requiring
client-side rate limiting or external proxies.</p>
<p>Quotas are disabled by default. When enabled, each client is tracked using either:</p>
<ul class="simple">
<li><p>Their authenticated <code class="docutils literal notranslate"><span class="pre">client_id</span></code> (derived from the Bearer token), or</p></li>
<li><p>Their IP address (fallback for anonymous requests)</p></li>
</ul>
<p>Quota state is stored in a SQLite-backed key-value store, and rate limits are applied
within a configurable time window (currently only <code class="docutils literal notranslate"><span class="pre">day</span></code> is supported).</p>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Link to this heading">ÔÉÅ</a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">quota</span><span class="p">:</span>
<span class="w">    </span><span class="nt">kvstore</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite</span>
<span class="w">      </span><span class="nt">db_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./quotas.db</span>
<span class="w">    </span><span class="nt">anonymous_max_requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">authenticated_max_requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
</pre></div>
</div>
</section>
<section id="configuration-options">
<h4>Configuration Options<a class="headerlink" href="#configuration-options" title="Link to this heading">ÔÉÅ</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kvstore</span></code></p></td>
<td><p>Required. Backend storage config for tracking request counts.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kvstore.type</span></code></p></td>
<td><p>Must be <code class="docutils literal notranslate"><span class="pre">&quot;sqlite&quot;</span></code> for now. Other backends may be supported in the future.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kvstore.db_path</span></code></p></td>
<td><p>File path to the SQLite database.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">anonymous_max_requests</span></code></p></td>
<td><p>Max requests per period for unauthenticated clients.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">authenticated_max_requests</span></code></p></td>
<td><p>Max requests per period for authenticated clients.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">period</span></code></p></td>
<td><p>Time window for quota enforcement. Only <code class="docutils literal notranslate"><span class="pre">&quot;day&quot;</span></code> is supported.</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Note: if <code class="docutils literal notranslate"><span class="pre">authenticated_max_requests</span></code> is set but no authentication provider is
configured, the server will fall back to applying <code class="docutils literal notranslate"><span class="pre">anonymous_max_requests</span></code> to all
clients.</p>
</div></blockquote>
</section>
<section id="example-with-authentication-enabled">
<h4>Example with Authentication Enabled<a class="headerlink" href="#example-with-authentication-enabled" title="Link to this heading">ÔÉÅ</a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8321</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom</span>
<span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://auth.example.com/validate</span>
<span class="w">  </span><span class="nt">quota</span><span class="p">:</span>
<span class="w">    </span><span class="nt">kvstore</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite</span>
<span class="w">      </span><span class="nt">db_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./quotas.db</span>
<span class="w">    </span><span class="nt">anonymous_max_requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">authenticated_max_requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
</pre></div>
</div>
<p>If a client exceeds their limit, the server responds with:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">429</span> <span class="ne">Too Many Requests</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Quota exceeded&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="extending-to-handle-safety">
<h2>Extending to handle Safety<a class="headerlink" href="#extending-to-handle-safety" title="Link to this heading">ÔÉÅ</a></h2>
<p>Configuring Safety can be a little involved so it is instructive to go through an example.</p>
<p>The Safety API works with the associated Resource called a <code class="docutils literal notranslate"><span class="pre">Shield</span></code>. Providers can support various kinds of Shields. Good examples include the <a class="reference external" href="https://ai.meta.com/research/publications/llama-guard-llm-based-input-output-safeguard-for-human-ai-conversations/">Llama Guard</a> system-safety models, or <a class="reference external" href="https://aws.amazon.com/bedrock/guardrails/">Bedrock Guardrails</a>.</p>
<p>To configure a Bedrock Shield, you would need to add:</p>
<ul class="simple">
<li><p>A Safety API provider instance with type <code class="docutils literal notranslate"><span class="pre">remote::bedrock</span></code></p></li>
<li><p>A Shield resource served by this provider.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">...</span>
<span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">safety</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bedrock</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote::bedrock</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">aws_access_key_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.AWS_ACCESS_KEY_ID}</span>
<span class="w">      </span><span class="nt">aws_secret_access_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.AWS_SECRET_ACCESS_KEY}</span>
<span class="nn">...</span>
<span class="nt">shields</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bedrock</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">guardrailVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.GUARDRAIL_VERSION}</span>
<span class="w">  </span><span class="nt">provider_shield_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.GUARDRAIL_ID}</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>The situation is more involved if the Shield needs <em>Inference</em> of an associated model. This is the case with Llama Guard. In that case, you would need to add:</p>
<ul class="simple">
<li><p>A Safety API provider instance with type <code class="docutils literal notranslate"><span class="pre">inline::llama-guard</span></code></p></li>
<li><p>An Inference API provider instance for serving the model.</p></li>
<li><p>A Model resource associated with this provider.</p></li>
<li><p>A Shield resource served by the Safety provider.</p></li>
</ul>
<p>The yaml configuration for this setup, assuming you were using vLLM as your inference server, would look like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">...</span>
<span class="nt">providers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">safety</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">llama-guard</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inline::llama-guard</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">inference</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># this vLLM server serves the &quot;normal&quot; inference model (e.g., llama3.2:3b)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vllm-0</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote::vllm</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.VLLM_URL:=http://localhost:8000}</span>
<span class="w">  </span><span class="c1"># this vLLM server serves the llama-guard model (e.g., llama-guard:3b)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vllm-1</span>
<span class="w">    </span><span class="nt">provider_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote::vllm</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.SAFETY_VLLM_URL:=http://localhost:8001}</span>
<span class="nn">...</span>
<span class="nt">models</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.INFERENCE_MODEL}</span>
<span class="w">  </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vllm-0</span>
<span class="w">  </span><span class="nt">provider_model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.SAFETY_MODEL}</span>
<span class="w">  </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vllm-1</span>
<span class="w">  </span><span class="nt">provider_model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="nt">shields</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">provider_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">llama-guard</span>
<span class="w">  </span><span class="nt">shield_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env.SAFETY_MODEL}</span><span class="w">   </span><span class="c1"># Llama Guard shields are identified by the corresponding LlamaGuard model</span>
<span class="w">  </span><span class="nt">provider_shield_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="nn">...</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="importing_as_library.html" class="btn btn-neutral float-left" title="Using Llama Stack as a Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../advanced_apis/index.html" class="btn btn-neutral float-right" title="Advanced APIs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Meta.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Read the Docs</span>
    v: v0.2.17
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      <dd>
        <a href="/v0.2.19/">latest</a>
      </dd>
      <dd>
        <a href="/v0.2.19/">v0.2.19</a>
      </dd>
      <dd>
        <a href="/v0.2.18/">v0.2.18</a>
      </dd>
      <dd class="rtd-current-item">
        <a href="/v0.2.17/">v0.2.17</a>
      </dd>
      <dd>
        <a href="/v0.2.16/">v0.2.16</a>
      </dd>
      <dd>
        <a href="/v0.2.15/">v0.2.15</a>
      </dd>
      <dd>
        <a href="/v0.2.14/">v0.2.14</a>
      </dd>
      <dd>
        <a href="/v0.2.13/">v0.2.13</a>
      </dd>
      <dd>
        <a href="/v0.2.12/">v0.2.12</a>
      </dd>
      <dd>
        <a href="/v0.2.11/">v0.2.11</a>
      </dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>