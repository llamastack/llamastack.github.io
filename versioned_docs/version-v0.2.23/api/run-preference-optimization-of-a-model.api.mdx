---
id: run-preference-optimization-of-a-model
title: "Run preference optimization of a model."
description: "Run preference optimization of a model."
sidebar_label: "Run preference optimization of a model."
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/llama-stack-specification
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Run preference optimization of a model."}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/v1alpha/post-training/preference-optimize"}
  context={"endpoint"}
>

</MethodEndpoint>



Run preference optimization of a model.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[]}
>

</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string","description":"The UUID of the job to create."},"finetuned_model":{"type":"string","description":"The model to fine-tune."},"algorithm_config":{"description":"The algorithm configuration.","type":"object","properties":{"beta":{"type":"number","description":"Temperature parameter for the DPO loss"},"loss_type":{"default":"sigmoid","description":"The type of loss function to use for DPO","type":"string","enum":["sigmoid","hinge","ipo","kto_pair"],"title":"DPOLossType"}},"additionalProperties":false,"required":["beta","loss_type"],"title":"DPOAlignmentConfig"},"training_config":{"description":"The training configuration.","type":"object","properties":{"n_epochs":{"type":"integer","description":"Number of training epochs to run"},"max_steps_per_epoch":{"type":"integer","default":1,"description":"Maximum number of steps to run per epoch"},"gradient_accumulation_steps":{"type":"integer","default":1,"description":"Number of steps to accumulate gradients before updating"},"max_validation_steps":{"type":"integer","default":1,"description":"(Optional) Maximum number of validation steps per epoch"},"data_config":{"description":"(Optional) Configuration for data loading and formatting","type":"object","properties":{"dataset_id":{"type":"string","description":"Unique identifier for the training dataset"},"batch_size":{"type":"integer","description":"Number of samples per training batch"},"shuffle":{"type":"boolean","description":"Whether to shuffle the dataset during training"},"data_format":{"description":"Format of the dataset (instruct or dialog)","type":"string","enum":["instruct","dialog"],"title":"DatasetFormat"},"validation_dataset_id":{"type":"string","description":"(Optional) Unique identifier for the validation dataset"},"packed":{"type":"boolean","default":false,"description":"(Optional) Whether to pack multiple samples into a single sequence for efficiency"},"train_on_input":{"type":"boolean","default":false,"description":"(Optional) Whether to compute loss on input tokens as well as output tokens"}},"additionalProperties":false,"required":["dataset_id","batch_size","shuffle","data_format"],"title":"DataConfig"},"optimizer_config":{"description":"(Optional) Configuration for the optimization algorithm","type":"object","properties":{"optimizer_type":{"description":"Type of optimizer to use (adam, adamw, or sgd)","type":"string","enum":["adam","adamw","sgd"],"title":"OptimizerType"},"lr":{"type":"number","description":"Learning rate for the optimizer"},"weight_decay":{"type":"number","description":"Weight decay coefficient for regularization"},"num_warmup_steps":{"type":"integer","description":"Number of steps for learning rate warmup"}},"additionalProperties":false,"required":["optimizer_type","lr","weight_decay","num_warmup_steps"],"title":"OptimizerConfig"},"efficiency_config":{"description":"(Optional) Configuration for memory and compute optimizations","type":"object","properties":{"enable_activation_checkpointing":{"type":"boolean","default":false,"description":"(Optional) Whether to use activation checkpointing to reduce memory usage"},"enable_activation_offloading":{"type":"boolean","default":false,"description":"(Optional) Whether to offload activations to CPU to save GPU memory"},"memory_efficient_fsdp_wrap":{"type":"boolean","default":false,"description":"(Optional) Whether to use memory-efficient FSDP wrapping"},"fsdp_cpu_offload":{"type":"boolean","default":false,"description":"(Optional) Whether to offload FSDP parameters to CPU"}},"additionalProperties":false,"title":"EfficiencyConfig"},"dtype":{"type":"string","default":"bf16","description":"(Optional) Data type for model parameters (bf16, fp16, fp32)"}},"additionalProperties":false,"required":["n_epochs","max_steps_per_epoch","gradient_accumulation_steps"],"title":"TrainingConfig"},"hyperparam_search_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The hyperparam search configuration."},"logger_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The logger configuration."}},"additionalProperties":false,"required":["job_uuid","finetuned_model","algorithm_config","training_config","hyperparam_search_config","logger_config"],"title":"PreferenceOptimizeRequest"}}},"required":true}}
>

</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"A PostTrainingJob.","content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string"}},"additionalProperties":false,"required":["job_uuid"],"title":"PostTrainingJob"}}}},"400":{"description":"The request was invalid or malformed","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":400,"title":"Bad Request","detail":"The request was invalid or malformed"}}}},"429":{"description":"The client has sent too many requests in a given amount of time","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":429,"title":"Too Many Requests","detail":"You have exceeded the rate limit. Please try again later."}}}},"500":{"description":"The server encountered an unexpected error","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":500,"title":"Internal Server Error","detail":"An unexpected error occurred. Our team has been notified."}}}},"default":{"description":"An unexpected error occurred","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":0,"title":"Error","detail":"An unexpected error occurred"}}}}}}
>

</StatusCodes>
