---
id: run-preference-optimization-of-a-model
title: "Run preference optimization of a model."
description: "Run preference optimization of a model."
sidebar_label: "Run preference optimization of a model."
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api-experimental/llama-stack-specification-experimental-apis
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Run preference optimization of a model."}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/v1alpha/post-training/preference-optimize"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Run preference optimization of a model.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string","description":"The UUID of the job to create."},"finetuned_model":{"type":"string","description":"The model to fine-tune."},"algorithm_config":{"description":"The algorithm configuration.","type":"object","properties":{"beta":{"type":"number","description":"Temperature parameter for the DPO loss"},"loss_type":{"default":"sigmoid","description":"The type of loss function to use for DPO","type":"string","enum":["sigmoid","hinge","ipo","kto_pair"],"title":"DPOLossType"}},"additionalProperties":false,"required":["beta","loss_type"],"title":"DPOAlignmentConfig"},"training_config":{"description":"The training configuration.","type":"object","properties":{"n_epochs":{"type":"integer","description":"Number of training epochs to run"},"max_steps_per_epoch":{"type":"integer","default":1,"description":"Maximum number of steps to run per epoch"},"gradient_accumulation_steps":{"type":"integer","default":1,"description":"Number of steps to accumulate gradients before updating"},"max_validation_steps":{"type":"integer","default":1,"description":"(Optional) Maximum number of validation steps per epoch"},"data_config":{"description":"(Optional) Configuration for data loading and formatting","type":"object","properties":{"dataset_id":{"type":"string","description":"Unique identifier for the training dataset"},"batch_size":{"type":"integer","description":"Number of samples per training batch"},"shuffle":{"type":"boolean","description":"Whether to shuffle the dataset during training"},"data_format":{"description":"Format of the dataset (instruct or dialog)","type":"string","enum":["instruct","dialog"],"title":"DatasetFormat"},"validation_dataset_id":{"type":"string","description":"(Optional) Unique identifier for the validation dataset"},"packed":{"type":"boolean","default":false,"description":"(Optional) Whether to pack multiple samples into a single sequence for efficiency"},"train_on_input":{"type":"boolean","default":false,"description":"(Optional) Whether to compute loss on input tokens as well as output tokens"}},"additionalProperties":false,"required":["dataset_id","batch_size","shuffle","data_format"],"title":"DataConfig"},"optimizer_config":{"description":"(Optional) Configuration for the optimization algorithm","type":"object","properties":{"optimizer_type":{"description":"Type of optimizer to use (adam, adamw, or sgd)","type":"string","enum":["adam","adamw","sgd"],"title":"OptimizerType"},"lr":{"type":"number","description":"Learning rate for the optimizer"},"weight_decay":{"type":"number","description":"Weight decay coefficient for regularization"},"num_warmup_steps":{"type":"integer","description":"Number of steps for learning rate warmup"}},"additionalProperties":false,"required":["optimizer_type","lr","weight_decay","num_warmup_steps"],"title":"OptimizerConfig"},"efficiency_config":{"description":"(Optional) Configuration for memory and compute optimizations","type":"object","properties":{"enable_activation_checkpointing":{"type":"boolean","default":false,"description":"(Optional) Whether to use activation checkpointing to reduce memory usage"},"enable_activation_offloading":{"type":"boolean","default":false,"description":"(Optional) Whether to offload activations to CPU to save GPU memory"},"memory_efficient_fsdp_wrap":{"type":"boolean","default":false,"description":"(Optional) Whether to use memory-efficient FSDP wrapping"},"fsdp_cpu_offload":{"type":"boolean","default":false,"description":"(Optional) Whether to offload FSDP parameters to CPU"}},"additionalProperties":false,"title":"EfficiencyConfig"},"dtype":{"type":"string","default":"bf16","description":"(Optional) Data type for model parameters (bf16, fp16, fp32)"}},"additionalProperties":false,"required":["n_epochs","max_steps_per_epoch","gradient_accumulation_steps"],"title":"TrainingConfig"},"hyperparam_search_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The hyperparam search configuration."},"logger_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The logger configuration."}},"additionalProperties":false,"required":["job_uuid","finetuned_model","algorithm_config","training_config","hyperparam_search_config","logger_config"],"title":"PreferenceOptimizeRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"A PostTrainingJob.","content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string"}},"additionalProperties":false,"required":["job_uuid"],"title":"PostTrainingJob"}}}},"400":{"description":"The request was invalid or malformed","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":400,"title":"Bad Request","detail":"The request was invalid or malformed"}}}},"429":{"description":"The client has sent too many requests in a given amount of time","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":429,"title":"Too Many Requests","detail":"You have exceeded the rate limit. Please try again later."}}}},"500":{"description":"The server encountered an unexpected error","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":500,"title":"Internal Server Error","detail":"An unexpected error occurred. Our team has been notified."}}}},"default":{"description":"An unexpected error occurred","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":0,"title":"Error","detail":"An unexpected error occurred"}}}}}}
>
  
</StatusCodes>


      