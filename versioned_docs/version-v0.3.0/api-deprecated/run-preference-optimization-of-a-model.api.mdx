---
id: run-preference-optimization-of-a-model
title: "Run preference optimization of a model."
description: "Run preference optimization of a model."
sidebar_label: "Run preference optimization of a model."
hide_title: true
hide_table_of_contents: true
api: eJztWkluHMkVvcpHriShSBblHty1Y5OSLUNqFjigYVBE4Vfkz8wQMyNSMRRZTdQZvPfKx/B5fAFfwfiRY40kBXohgFywiKyIP78/Je8jQ7bUypKNRvfR2+GQP2KywsjSSa2iUXQEY23dhUGppEr/pqf70SASWjlSjk9jWeZSIJ8++GL5yn1kRUYF8l9uXlI0ivT0CwkXDaLS6JKMkxXDL3o68V7GvZPWGanSaLEYRBjHksliPu7dSjC3NIgMffXSUByNrjoy14PISZcznRWho8WCSf6wScOLjIDJkXVwixakmmEuY9AGCswTbQqKn09n69B52zsnlaOUTDRYEeuvFxdjqE6D0DFFi1a7VWutXn1njDYQDg8AwWbaOLC+KNDMQSfgMgIKZ24zKTKQldJGonKQaAOo6u8DnwXTdyjzx3KuTjPrXKuUDGS+QLVnCGOc5gS9O0viMCeprEMlHqHlq9OyCo/XcASXZx9rZQQqmBJ4SzE4DYackTQjKLQhkIr9GTwHONXeBea2JCETKUAL4Y0hJWhFrqeEY+3hxlut8XrRGcy0xXgNJCExuggyHI0/7MOZ9mmWzyHRea5vLZy9P4af/zz8eZ+NRndYlFVkNPH1w3DY8fsVYzirQryT55GRXyPn7S+bkSNyScpBhhYs/+G0hgLVvCHMVAEhlTNSgIX2ygXbyoJeQPUCqu8MVG9/6fhdaA2fONJrZNk+tP6uPWQ4I6A7QRSz2Rhs6AhyWUi3D+Oc0BI4MwdMUSrI0ZHZr/H247ZKZcnMyAApwVAiQzEHlld0V5JwFNfGfYHWC7S+K2j92K9XHziyFeZwXkV7x7+G19F6yDfGiPfh1BtwhEWoSlMiBUo7mUiKG3jFlKDP3YZ2dwfhF1C9gOr7AtVwE7dHQCighEMNU8va9KcpeHWsC/4811q9ZoWWFTjzCkpDCdUmLJ0s5B/Y+Bmh0DHlPEWWaLAgR4Z5XFf2I+t+1fGclfi/D5mrknN5vbz8cNK4/YuecvAIQ+gomDiRipxXFE+CEo8jGY4yIb69x9cDLcxTbaTLionQKpHp5nLfnoLqlDfBCmy+3WpPyfWNo3wx3ZBfLqgoyaDzhqB1R0A/G+BkfAq5tpbF5c9JRey+S5+RlWmhZbxRcT7NtuSrkHglQgw4zbAMPE7Gp50erQVJ+SJAqCWdSZUyhmSpo0F04/SkRGn6WDoZn37U1l6ETPUUnAYz9bVbJnqUy1QVpNxx5SPGRI2DnW5rDj3Va2pCpRbZY0rDb8GjIVYbZtXdkPC8YlkLvJtYR6WdlGQq0lso1/48XOXyCe9k4QtQLbdAr+YBJbeigexiEKUGYx4GJyiEL3wedK74P5Hrb+vcWpoEDR+u7QkndF/G6MLaqFI5TLHfzr1XU9bV72jXsi2ZIEaHWwOjR/e4HxYBC3wTco0xOxJVDFWNchUmdkcN37XkJo9JcpdKfvUEMiYVWqIO7W0Y1eRYnyk6kU2s/IOeFJE2VKLKNi3ZQIuJ2swnyVILM9U6J1RrFH/PyGVMQ0N9KUhaCwixZxVbDq0DKtOtO+B9eN6k94bKK+42jBeO9x6xxFynr3ekpeY0CxsOL6WMimbFiOXpheJTvNQLle0O64Viz2UlihuKtxi3Dvk6EW7l2bM7k4PC506WObWOlYohCVaqlJ9y4eZiz5JRkkghSYl5my0nWk2kKr17NqmELkrPszSXFq0gUAenb0hZQAu3lOf8qb3rvnhaZei5awkHXfwuR9tKFHQFo+6AyHxbYmBPLzVRbUvwYF7oOHeFe6lS1QW6PdcU51cYYzEA/n07YFjYNN6FCT4YDcLHLRsoXdrFnzbkL+pBIjcPdyYfCU1IG2FnsmIIClPCLck0c5OYBM4fJvh7OA3hNAjdhGk16xhKfY6mNjETV76Y3KIpfLmzhuyqWkw4X1KjIvi0OFxxYrDeiu4bpN1k/i4kO4x+W0wWVGjeW6m4RWI/RO2DkUmKZ8AJCidnVXYUGYmbUksVKt5z5QkO5o4JLDGpBsPYC2r08RbTEKDr4ukkqYvzs8lWk+zJFxqd4/FlqHe8PPzL+LKWLbQ24a9JG7mTxMbl5NZg+az2qtjsdQB5f34yBmZT1kU28BWlb6zy7CYJHLvxsDbLw7hph902vruYj5scuF55m2Fmmhz+tKsUc16vppoAgjDX9aR8xfcHkJTV7z+9ff00pLfN/+bGfXeD3QN8M6l3umfzkkyQdGIJjch6sF8F6mZx7yOt6DSJRle9PJvn0WKw5vreozoV954073e7J2gMzvsPakkW14tNQ2WnClSqrI5YYVZN06Vy+53pWMm/ptg3vRNfX1psWD2sT7U7YmbVvv237u3epyk6zVvHsE7qBHTGU1C9NCTQNY84x7lMx9EoKnV4V1miy6JRdDA7POAne42cB92Kaa+pkNx5hH2xDS70htdcmXPl6OAA1Xwv09ZRvJfnWOCedShu9oUuosU13xPeSDcPF0+ahHB1zd/xwumsW02969Zs3WqpyyZrK6Luq00bn2pNM1zar7Sbj83bhm5HMNwy4R8+MIsfbhuTD9cn2N7Q0mnSHwuHvYGu8uHSDNafl7YMQx3dZnZp0vnK8BAeb+moV3vdpiflXnO42isON/V3w22N0YPNSi3u7q6hPrSriNdH1stro3jcpCEuVLvz+oY0uAib9USHjFgj9iODAc4ZDHBeb8CrXmkPTlp08vaZyxJjq0pTs8MNKz9+hWCXlunt2pcf9nm5DB2URs9kTPazgpUfBJ7MdQKk4mBnG5pNl5HkvGiq/XjYlXA3bhIUZCuiaOiz4h23NmH5v058yv/vkNOMDKaNVJ8YrHb/s/qs3rz5zz//9d9//wNO3o3P3h0fXbw7efNmBB8pRTEPlqgYFTjndwyGCj2jmP/NIfFhkVpbye7DZb3oLGRad8+9xbjK56FacV4rMOy0FRb0pBX6kgd6K/MnkKhDytGdOyhzlGH6Cbnzvs6+V5W3l/Jv6OjXM/D1IOIsy3fu76do6dLkiwU//urJzKs9f3jJNOXwu+L6lxHGZELmvaF5NIqOKy32Lqp5Z4a5D4BefQnA9bS6cSQElW7n2etebRmfnl9wFqtfNLApolFkkGdX/j2KoirJ8Cgzuq+e3Uc5qtTzhDCKKpr88z91mecP
sidebar_class_name: "post api-method"
info_path: docs/api-deprecated/llama-stack-specification-deprecated-apis
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Run preference optimization of a model."}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/v1/post-training/preference-optimize"}
  context={"endpoint"}
>
  
</MethodEndpoint>

:::caution deprecated

This endpoint has been deprecated and may be replaced or removed in future versions of the API.

:::

Run preference optimization of a model.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string","description":"The UUID of the job to create."},"finetuned_model":{"type":"string","description":"The model to fine-tune."},"algorithm_config":{"description":"The algorithm configuration.","type":"object","properties":{"beta":{"type":"number","description":"Temperature parameter for the DPO loss"},"loss_type":{"default":"sigmoid","description":"The type of loss function to use for DPO","type":"string","enum":["sigmoid","hinge","ipo","kto_pair"],"title":"DPOLossType"}},"additionalProperties":false,"required":["beta","loss_type"],"title":"DPOAlignmentConfig"},"training_config":{"description":"The training configuration.","type":"object","properties":{"n_epochs":{"type":"integer","description":"Number of training epochs to run"},"max_steps_per_epoch":{"type":"integer","default":1,"description":"Maximum number of steps to run per epoch"},"gradient_accumulation_steps":{"type":"integer","default":1,"description":"Number of steps to accumulate gradients before updating"},"max_validation_steps":{"type":"integer","default":1,"description":"(Optional) Maximum number of validation steps per epoch"},"data_config":{"description":"(Optional) Configuration for data loading and formatting","type":"object","properties":{"dataset_id":{"type":"string","description":"Unique identifier for the training dataset"},"batch_size":{"type":"integer","description":"Number of samples per training batch"},"shuffle":{"type":"boolean","description":"Whether to shuffle the dataset during training"},"data_format":{"description":"Format of the dataset (instruct or dialog)","type":"string","enum":["instruct","dialog"],"title":"DatasetFormat"},"validation_dataset_id":{"type":"string","description":"(Optional) Unique identifier for the validation dataset"},"packed":{"type":"boolean","default":false,"description":"(Optional) Whether to pack multiple samples into a single sequence for efficiency"},"train_on_input":{"type":"boolean","default":false,"description":"(Optional) Whether to compute loss on input tokens as well as output tokens"}},"additionalProperties":false,"required":["dataset_id","batch_size","shuffle","data_format"],"title":"DataConfig"},"optimizer_config":{"description":"(Optional) Configuration for the optimization algorithm","type":"object","properties":{"optimizer_type":{"description":"Type of optimizer to use (adam, adamw, or sgd)","type":"string","enum":["adam","adamw","sgd"],"title":"OptimizerType"},"lr":{"type":"number","description":"Learning rate for the optimizer"},"weight_decay":{"type":"number","description":"Weight decay coefficient for regularization"},"num_warmup_steps":{"type":"integer","description":"Number of steps for learning rate warmup"}},"additionalProperties":false,"required":["optimizer_type","lr","weight_decay","num_warmup_steps"],"title":"OptimizerConfig"},"efficiency_config":{"description":"(Optional) Configuration for memory and compute optimizations","type":"object","properties":{"enable_activation_checkpointing":{"type":"boolean","default":false,"description":"(Optional) Whether to use activation checkpointing to reduce memory usage"},"enable_activation_offloading":{"type":"boolean","default":false,"description":"(Optional) Whether to offload activations to CPU to save GPU memory"},"memory_efficient_fsdp_wrap":{"type":"boolean","default":false,"description":"(Optional) Whether to use memory-efficient FSDP wrapping"},"fsdp_cpu_offload":{"type":"boolean","default":false,"description":"(Optional) Whether to offload FSDP parameters to CPU"}},"additionalProperties":false,"title":"EfficiencyConfig"},"dtype":{"type":"string","default":"bf16","description":"(Optional) Data type for model parameters (bf16, fp16, fp32)"}},"additionalProperties":false,"required":["n_epochs","max_steps_per_epoch","gradient_accumulation_steps"],"title":"TrainingConfig"},"hyperparam_search_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The hyperparam search configuration."},"logger_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The logger configuration."}},"additionalProperties":false,"required":["job_uuid","finetuned_model","algorithm_config","training_config","hyperparam_search_config","logger_config"],"title":"PreferenceOptimizeRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"A PostTrainingJob.","content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string"}},"additionalProperties":false,"required":["job_uuid"],"title":"PostTrainingJob"}}}},"400":{"description":"The request was invalid or malformed","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":400,"title":"Bad Request","detail":"The request was invalid or malformed"}}}},"429":{"description":"The client has sent too many requests in a given amount of time","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":429,"title":"Too Many Requests","detail":"You have exceeded the rate limit. Please try again later."}}}},"500":{"description":"The server encountered an unexpected error","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":500,"title":"Internal Server Error","detail":"An unexpected error occurred. Our team has been notified."}}}},"default":{"description":"An unexpected error occurred","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":0,"title":"Error","detail":"An unexpected error occurred"}}}}}}
>
  
</StatusCodes>


      